<div class="thinkTag">

嗯，用户问的是在测试时生成的.sys文件没有签名该怎么办。首先，我得回忆一下Windows驱动签名的要求。Windows从Vista开始就要求驱动必须有数字签名，否则无法加载，尤其是在64位系统上。测试的时候可能遇到这个问题，特别是开发者可能没有购买正式的签名证书，或者只是在内部测试，所以需要找到解决办法。

首先，用户可能是在开发阶段，频繁修改和测试驱动，每次签名可能不太实际，尤其是如果使用正式的签名证书的话，成本可能很高。这时候可能需要禁用驱动签名强制，这样系统就可以加载未签名的驱动。我记得Windows有个启动选项可以临时禁用驱动签名强制，比如通过高级启动选项，选择“禁用驱动程序强制签名”模式。不过这个方法可能每次重启都需要操作，对于频繁测试来说有点麻烦。

另外，用户可能使用的是测试模式，也就是Windows的测试签名功能。通过bcdedit命令开启测试模式，这样系统允许加载带有测试签名的驱动。不过测试签名需要自己生成一个证书，然后对驱动进行签名，虽然这个证书不是受信任的，但在测试模式下是可以的。这可能比每次重启禁用更方便，但需要配置一些步骤，比如生成自签名证书，安装到系统的受信任根证书库，然后使用这个证书签名驱动。不过如果是完全未签名的驱动，可能还是不行，可能需要先进行测试签名。

还有用户可能不知道如何生成自签名证书，或者如何在测试模式下使用。可能需要指导他们使用MakeCert或者PowerShell的New-SelfSignedCertificate命令来创建证书，然后用SignTool进行签名。同时，安装证书到本地计算机的受信任根证书颁发机构，这样系统才会信任这个测试签名。

另外，如果是虚拟机环境下测试，可能更方便，因为可以随时重置系统状态，不用担心安全问题。这时候禁用驱动签名强制可能更简单，不需要处理证书的问题。

还有可能用户不知道如何正确配置驱动项目的属性，比如在Visual Studio中，设置驱动为测试签名，或者配置项目生成后事件自动进行签名。这可能帮助自动化流程，减少手动操作。

不过需要考虑不同Windows版本的要求，比如Windows 10和11对驱动签名的要求可能更严格，特别是Secure Boot开启的情况下，可能测试模式也需要一些额外步骤。可能需要提醒用户检查Secure Boot的状态，必要时在BIOS/UEFI中关闭它，以便测试未签名的驱动。

另外，长期解决方案还是建议获取有效的WHQL签名，但测试阶段可能不需要，所以临时解决方案更为实际。用户可能需要分步骤的指导，从最简单的禁用签名强制到设置测试模式和使用自签名证书，逐步深入。

还要注意权限问题，比如运行bcdedit需要管理员权限，生成证书和签名工具的使用也需要正确的命令行参数。可能需要提供具体的命令示例，方便用户复制粘贴操作。

总结下来，回答应该分步骤，首先是最简单的禁用驱动签名强制的方法，然后是测试模式和使用自签名证书，最后提到虚拟机和长期解决方案。同时，提醒不同系统版本和Secure Boot的影响，确保用户能根据具体情况选择合适的方法。


</div>



在Windows系统中，未签名的驱动程序（.sys文件）默认无法加载，尤其是在64位系统上。以下是几种解决测试阶段未签名驱动问题的方案：

---

### **1. 临时禁用驱动签名强制（推荐）**
适用于快速测试，但每次重启后需重复操作：
- **步骤**：
  1. **重启电脑**，在启动时按住 `Shift` 键并选择 **"重启"**。
  2. 进入 **"疑难解答" → "高级选项" → "启动设置" → "重启"**。
  3. 重启后按 `F7` 或数字键 `7`，选择 **"禁用驱动程序强制签名"**。
  4. 进入系统后，即可加载未签名的驱动。

---

### **2. 启用Windows测试模式**
允许加载测试签名的驱动（需管理员权限）：
- **步骤**：
  1. 以管理员身份打开命令提示符或PowerShell。
  2. 输入以下命令启用测试模式：
     ```cmd
     bcdedit /set testsigning on
     ```
  3. 重启电脑，桌面右下角会显示 **"测试模式"** 水印。
  4. 使用自签名证书对驱动进行测试签名（见下文）。

---

### **3. 使用自签名证书测试签名驱动**
#### **生成自签名证书**
- **使用 PowerShell**：
  ```powershell
  New-SelfSignedCertificate -Type CodeSigning -Subject "CN=MyTestCertificate" -CertStoreLocation Cert:\LocalMachine\My
  ```
  导出证书到文件（可选）：
  ```powershell
  $cert = Get-ChildItem -Path Cert:\LocalMachine\My\<证书指纹>
  Export-Certificate -Cert $cert -FilePath .\MyTestCertificate.cer
  ```

#### **签名驱动文件**
使用微软的 `SignTool`（需安装Windows SDK）：
```cmd
signtool sign /v /s MY /n "MyTestCertificate" /t http://timestamp.digicert.com YourDriver.sys
```

#### **安装证书到受信任根证书**
1. 双击导出的 `.cer` 文件。
2. 选择 **"安装证书" → "本地计算机" → "将所有证书放入以下存储" → "受信任的根证书颁发机构"**。

---

### **4. 使用虚拟机测试**
在虚拟机（如VMware或Hyper-V）中测试未签名驱动，可关闭安全验证：
- 关闭虚拟机的 **Secure Boot**（在虚拟机设置中）。
- 在虚拟机内禁用驱动签名强制（方法同方案1）。

---

### **5. 长期解决方案：获取有效签名**
- **购买EV代码签名证书**：适用于公开发布的驱动，通过微软WHQL认证。
- **开发阶段**：可使用测试签名，但正式发布前需正式签名。

---

### **注意事项**
- **Secure Boot影响**：若系统开启Secure Boot，即使测试模式也可能无法加载未签名驱动，需在BIOS/UEFI中临时关闭。
- **驱动开发环境配置**：在Visual Studio中配置驱动项目属性，启用测试签名（`Driver Signing → Test Certificate`）。

根据需求选择合适的方法，测试完成后建议恢复系统安全设置！