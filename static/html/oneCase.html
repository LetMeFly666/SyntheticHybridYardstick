<!--
 * @Author: LetMeFly
 * @Date: 2025-02-08 17:09:53
 * @LastEditors: LetMeFly.xyz
 * @LastEditTime: 2025-02-12 16:19:37
-->
<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <title>LetSHY - æ¡ˆä¾‹ - {{ fileName }}</title>
    <script src="https://letmefly.xyz/Links/Common.js" async></script>
    <script src="/static/js/marked.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f8fa;
            color: #333;
        }

        h1,
        h2,
        h3 {
            color: #2c3e50;
            margin-bottom: 20px;
        }

        h3 {
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        #header {
            margin-bottom: 30px;
        }

        #header button {
            background-color: #3498db;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        #header button:hover {
            background-color: #2980b9;
        }

        .status-tags .badge {
            background-color: #e1f5fe;
            color: #0277bd;
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 0.9em;
        }

        #progress>div {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        #progress h3 {
            color: #3498db;
            margin-bottom: 15px;
        }

        #progress button,
        #backToMainPage {
            background-color: #3498db;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        #progress button:hover {
            background-color: #2980b9;
        }

        details {
            margin-top: 15px;
        }

        details[open] {
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 10px;
            margin: 5px 0;
        }

        summary {
            cursor: pointer;
            padding: 4px;
            list-style: none;
            font-weight: 500;
            color: #2c3e50;
        }

        summary::before {
            content: "ğŸ‘‰";
            padding-right: 6px;
        }

        details[open] summary::before {
            content: "ğŸ‘‡";
        }

        pre {
            background-color: #f8f9fa;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            padding: 15px;
            overflow-x: auto;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9em;
        }

        .inputText {
            border: 1px solid #ccc;
            padding: 10px;
            margin: 10px 0;
            background-color: #f8f9fa;
            border-radius: 4px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9em;
        }

        .inputText::before {
            content: 'Told DeepSeek:';
            color: black;
            font-size: large;
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
        }

        .thinkTag {
            color: gray;
            border-left: 1px solid #ccc;
            padding-left: 10px;
            margin: 10px 0;
            font-style: italic;
        }

        .thinkTag::before {
            content: 'ğŸ’­æ€è€ƒå†…å®¹';
            margin-left: -15px;
            font-weight: bold;
        }

        .output {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9em;
        }

        .markdown {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }

        select {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin: 10px 0;
            width: 100%;
            max-width: 400px;
        }

        .forbidden {
            display: none;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            body {
                padding: 15px;
            }

            #progress>div {
                padding: 15px;
            }

            pre,
            .inputText,
            .output,
            .markdown {
                font-size: 0.85em;
            }
        }
    </style>
</head>

<body>
    <h1>LetSHY - æ¡ˆä¾‹ - {{ fileName }}</h1>
    <div name="header">
        <button id="backToMainPage">å›åˆ°ä¸»é¡µ</button>
        <h2>æµç¨‹è¯´æ˜</h2>
        <pre><code class="mermaid">
            graph LR
                classDef process fill:#E5F6FF,stroke:#73A6FF,stroke-width:2px;
            
                A(ä¸Šä¼ æ¡ˆä¾‹æ–‡ä»¶):::process --> B(DSåˆæ­¥åˆ†æ):::process
                B --> C(ç»™DSå†³ç­–æ ‘å¹¶è®©å®ƒå†æ¬¡åˆ†æ):::process
                C --> D{çº æ­£DSé”™è¯¯}:::process
                D --> |æ˜¯| E(é”™è¯¯çº æ­£å¯¹è¯):::process
                D --> |å¦| F(ç”Ÿæˆä½¿ç”¨å†³ç­–æ ‘å‰åçš„ç»“æœå¯¹æ¯”è¡¨):::process
                E --> F
        </code></pre>
        <h3>æ¡ˆä¾‹åç§°ï¼š{{ fileName }}</h3>
        <div class="status-tags">
            <span class="badge">åˆ†æé˜¶æ®µï¼š{{ progress_now }}</span>
        </div>
    </div>

    <div id="progress">
        <div id="progress-1">
            <h3>æ­¥éª¤1ï¼šä¸Šä¼ æ¡ˆä¾‹æ–‡ä»¶(<span name="state"></span>)</h3>
            <div name="option"></div>
        </div>
        <div id="progress-2">
            <h3>æ­¥éª¤2ï¼šDSåˆæ­¥åˆ†æ(<span name="state"></span>)</h3>
            <div name="option">
                <button id="progress-2-start">å¼€å§‹åˆ†æ</button>
            </div>
            <details name="log" id="log2">
                <summary>æ­¥éª¤æ—¥å¿—</summary>
                <pre><code class="inputText">
è¯·ç»“åˆç›¸å…³æ³•å¾‹å¯¹æœ¬æ¡ˆè¿›è¡Œåˆ¤å†³
ã€åŸæ¡ˆä¾‹ã€‘
                </code></pre>
                <div name="log-content">
                    <div class="output forbidden" id="output2"></div>
                    <div class="markdown" id="markdown2"></div>
                </div>
            </details>
        </div>
        <div id="progress-3">
            <h3>æ­¥éª¤3ï¼šç»™DSå†³ç­–æ ‘å¹¶è®©å®ƒå†æ¬¡åˆ†æ(<span name="state"></span>)</h3>
            <div name="option">
                <button id="progress-3-start">å¼€å§‹åˆ†æ</button>
            </div>
            <details name="log" id="log3">
                <summary>æ­¥éª¤æ—¥å¿—</summary>
                <pre><code class="mermaid">
graph LR
    classDef startend fill:#F5EBFF,stroke:#BE8FED,stroke-width:2px
    classDef process fill:#E5F6FF,stroke:#73A6FF,stroke-width:2px
    A([æ˜¯å¦ç™»è®°ç»“å©š]):::startend -->|æ˜¯| B{æ˜¯å¦æ»¡è¶³ç¦»å©šæ¡ä»¶?}:::process
    A -->|å¦| F{æ˜¯å¦å…±åŒç”Ÿæ´»?}:::process
    B -->|å¦| C([ä¸è¿”è¿˜å½©ç¤¼]):::startend
    B -->|æ˜¯| E{æ˜¯å¦å…±åŒç”Ÿæ´»?}:::process
    B -->|æ˜¯| J{å©šå‰ç»™ä»˜æ˜¯å¦å›°éš¾?}:::process
    F -->|æ˜¯| G([ç»“åˆå½©ç¤¼ å®é™…ä½¿ç”¨/å«å¦†æƒ…å†µ/åŒæ–¹è¿‡é”™/å½“åœ°ä¹ ä¿— å†³å®šæ˜¯å¦è¿”è¿˜å½©ç¤¼]):::startend
    F -->|å¦| H([å…¨éƒ¨è¿”è¿˜å½©ç¤¼]):::startend
    E -->|æ˜¯| I{å…±åŒç”Ÿæ´»æ—¶é—´æ˜¯å¦è¾ƒçŸ­}:::process
    I -->|æ˜¯| K{å½©ç¤¼æ•°é¢æ˜¯å¦è¿‡é«˜}:::process
    K -->|æ˜¯| G
    I -->|å¦| C
    K -->|å¦| C
    J -->|æ˜¯| H
    J -->|å¦| C
                </code></pre>
                <pre><code class="inputText">
è¯·æ ¹æ®è¿™ä¸ªå†³ç­–æ ‘è¿›è¡Œåˆ¤å†³ï¼š
A[æ˜¯å¦ç™»è®°ç»“å©š]-->|æ˜¯|B[æ˜¯å¦æ»¡è¶³ç¦»å©šæ¡ä»¶?];
A-->|å¦|F[æ˜¯å¦å…±åŒç”Ÿæ´»?];
B -->|å¦|C[ä¸è¿”è¿˜å½©ç¤¼];
B -->|æ˜¯|E[æ˜¯å¦å…±åŒç”Ÿæ´»?];
B -->|æ˜¯ |[å©šå‰ç»™ä»˜æ˜¯å¦å›°éš¾?];
F-->|æ˜¯|G[ç»“åˆå½©ç¤¼å®é™…ä½¿ç”¨ã€å«å¦†æƒ…å†µã€åŒæ–¹è¿‡é”™ã€å½“åœ°ä¹ ä¿—å†³å®šæ˜¯å¦è¿”è¿˜å½©ç¤¼];
F-->|å¦|H[å…¨éƒ¨è¿”è¿˜å½©ç¤¼];
E -->|æ˜¯|I[å…±åŒç”Ÿæ´»æ—¶é—´æ˜¯å¦è¾ƒçŸ­];
I-->|æ˜¯|K[å½©ç¤¼æ•°é¢æ˜¯å¦è¿‡é«˜];
K -->|æ˜¯|G;
I-->|å¦|C;
K -->|å¦|C;
J-->|æ˜¯|H;
J-->|å¦|C;</code></pre>
                <div name="log-content">
                    <div class="output forbidden" id="output3"></div>
                    <div class="markdown" id="markdown3"></div>
                </div>
            </details>
        </div>
        <div id="progress-4">
            <h3>æ­¥éª¤4ï¼šçº æ­£DSé”™è¯¯(<span name="state" id="state4"></span>)</h3>
            <div name="option">
                <div>ä¸Šä¸€æ­¥åˆ¤æ–­ç»“æœæ˜¯å¦éœ€è¦ä¿®æ”¹ï¼Ÿ</div>
                <select id="optionSelect4">
                    <option value="">è¯·é€‰æ‹©</option>
                    <option value="A">æ— éœ€æ›´æ”¹</option>
                    <option value="B">åŸæ¡ˆä»¶ä¸­çš„å©šå§»ç™»è®°çŠ¶å†µé”™è¯¯ï¼Œè¯·å°†å©šå§»ç™»è®°æ›´æ”¹æˆç›¸åçš„çŠ¶å†µï¼ˆå³å·²ç™»è®°æ”¹ä¸ºæœªç™»è®°ï¼Œæœªç™»è®°æ”¹ä¸ºå·²ç™»è®°ï¼‰ï¼Œå¹¶æ ¹æ®ä¿®æ”¹åçš„æ¡ˆä»¶æƒ…å†µè¿›è¡Œé‡æ–°åˆ¤å†³</option>
                </select>
                <div><button id="button4" class="forbidden">ç¡®è®¤</button></div>
            </div>
            <details name="log" id="log4">
                <summary>æ­¥éª¤æ—¥å¿—</summary>
                <div id="input4"></div>
                <div class="output forbidden" id="output4"></div>
                <div class="markdown" id="markdown4"></div>
            </details>
        </div>
        <div id="progress-5">
            <h3>æ­¥éª¤5ï¼šç”Ÿæˆä½¿ç”¨å†³ç­–æ ‘å‰åçš„ç»“æœå¯¹æ¯”è¡¨(<span name="state"></span>)</h3>
            <div name="option">
                <button id="progress-5-start">å¼€å§‹åˆ†æ</button>
            </div>
            <details name="log" id="log5">
                <summary>æ­¥éª¤æ—¥å¿—</summary>
                <pre><code class="inputText">
è¯·ä»æ˜¯å¦ç™»è®°ç»“å©šã€åˆ¤å†³ä¾æ®ã€å½©ç¤¼è¿”è¿˜æ¯”ä¾‹ã€è¯‰è®¼è´¹ç”¨åˆ†æ‹…å››ä¸ªæ–¹é¢å¯¹æ¯”ä»¥ä¸Šåˆ¤å†³
                </code></pre>
                <div name="log-content">
                    <div class="output forbidden" id="output5"></div>
                    <div class="markdown" id="markdown5"></div>
                </div>
            </details>
        </div>
    </div>
    <script name="showLogs">
        function showLog1() {
            // Nothing to do
        }

        let eventSource2;
        let alreadyEnd2 = true;  // é˜²æ­¢æœ¬æ¥å°±å¯¹è¯ç»“æŸå¯¼è‡´çš„é‡å¤æ¸²æŸ“
        let eventSource3;
        let alreadyEnd3 = true;  // é˜²æ­¢æœ¬æ¥å°±å¯¹è¯ç»“æŸå¯¼è‡´çš„é‡å¤æ¸²æŸ“
        let eventSource4;
        let alreadyEnd4 = true;  // é˜²æ­¢æœ¬æ¥å°±å¯¹è¯ç»“æŸå¯¼è‡´çš„é‡å¤æ¸²æŸ“
        let eventSource5;
        let alreadyEnd5 = true;  // é˜²æ­¢æœ¬æ¥å°±å¯¹è¯ç»“æŸå¯¼è‡´çš„é‡å¤æ¸²æŸ“
        function showLog_baseFor2345(eventSource2345, outputSelector, alreadyEnd, step) {
            if (eventSource2345) {
                eventSource2345.close();
            }
            const eventSource = new EventSource(`/chatData/${caseHash}/${step}`);
            eventSource2345 = eventSource;
            const output = document.querySelector(outputSelector);
            var responseText = '';
            eventSource.onmessage = () => {
                const data = JSON.parse(event.data);
                responseText += data['content'];
                output.innerHTML = responseText;
                if (data['code'] == 1) {  // ç»“æŸ
                    eventSource.close();
                    if (!alreadyEnd) {
                        alert('å¯¹è¯ç»“æŸ');
                        // nowStep = nextStep();
                        // renderProgress();  // é‡æ–°æ¸²æŸ“å¯¹è¯çŠ¶æ€
                        setTimeout(() => {
                            location.reload();
                        }, 1500);
                    }
                    return;
                }
                if (data['code'] == 2) {  // å¯¹è¯ä¸å­˜åœ¨
                    eventSource.close();
                    console.log('å¯¹è¯ä¸å­˜åœ¨ï¼');
                } else {
                    alreadyEnd = false;
                }
            };
            eventSource.onerror = (err) => {
                console.log('è¿æ¥é”™è¯¯ï¼', err);
                eventSource.close();
            }
        }


        function showLog2() {
            showLog_baseFor2345(eventSource2, '#progress-2 [name=log] .output', alreadyEnd2, 2);
        }

        function showLog3() {
            showLog_baseFor2345(eventSource3, '#progress-3 [name=log] .output', alreadyEnd3, 3);
        }

        async function showLog4() {
            const response = await fetch(`/chatIfHad4/${caseHash}`);
            const data = await response.json();
            const optionSelect4 = document.getElementById('optionSelect4');
            if (data['code'] == 0) {
                optionSelect4.value = 'B';  // è¿›è¡Œäº†æ›´æ”¹
                optionSelect4.classList.add('forbidden');
                showLog_baseFor2345(eventSource4, '#progress-4 [name=log] .output', alreadyEnd4, 4);
            } else if (data['code'] == 2) {  // æš‚æœªé€‰æ‹©
                optionSelect4.value = '';
            } else {  // 1
                optionSelect4.value = 'A';  // æ— éœ€æ›´æ”¹ï¼Œè·³è¿‡step4
                optionSelect4.classList.add('forbidden');
                document.querySelector('#state4').innerHTML = 'å·²è·³è¿‡';
            }
            responseSelect4();
            // nextStep();
            // renderProgress();
        }

        function showLog5() {
            showLog_baseFor2345(eventSource5, '#progress-5 [name=log] .output', alreadyEnd5, 5);
        }

    </script>

    <script>
        const caseHash = '{{ caseHash }}';
        const stepList = [
            'ä¸Šä¼ æ¡ˆä¾‹æ–‡ä»¶',                 // 1
            'DSåˆæ­¥åˆ†æ',                   // 2
            'ç»™DSå†³ç­–æ ‘å¹¶è®©å®ƒå†æ¬¡åˆ†æ',      // 3
            'çº æ­£DSé”™è¯¯',                   // 4
            'ç”Ÿæˆä½¿ç”¨å†³ç­–æ ‘å‰åçš„ç»“æœå¯¹æ¯”è¡¨'  // 5
        ];
        const showLogFunctions = [
            showLog1,  // step1
            showLog2,  // step2
            showLog3,  // step3
            showLog4,  // step4
            showLog5,  // step5
        ];
        var nowStep = '{{ progress_now }}';

        // function nextStep() {
        //     for (var i = 0; i < stepList.length; i++) {
        //         if (stepList[i] === nowStep) {
        //             nowStep = stepList[i + 1];
        //             return;
        //         }
        //     }
        // }

        function renderProgress() {
            const progressDiv = document.getElementById('progress');
            var finished = true;
            for (var step = 1; step <= stepList.length; step++) {
                const stepDiv = document.getElementById('progress-' + step);
                const optionDiv = stepDiv.querySelector('[name=option]');
                const statusSpan = stepDiv.querySelector('[name=state]');
                const logDetails = stepDiv.querySelector('[name=log]');
                if (finished) {
                    statusSpan.innerHTML = 'å·²å®Œæˆ';
                    optionDiv.classList.add('forbidden');
                    showLogFunctions[step - 1]();
                    if (nowStep === stepList[step - 1]) {  // åˆšå¥½å®Œæˆåˆ°è¿™ä¸€æ­¥
                        finished = false;
                    }
                } else {
                    if (nowStep === stepList[step - 2]) {  // åº”è¯¥æˆ–è€…æ­£åœ¨å®Œæˆè¿™ä¸€æ­¥
                        statusSpan.innerHTML = 'è¿›è¡Œåˆ°';
                        optionDiv.classList.remove('forbidden');
                        showLogFunctions[step - 1]();
                    } else {
                        statusSpan.innerHTML = 'æœªå¼€å§‹';
                        optionDiv.classList.add('forbidden');
                        logDetails && logDetails.classList.add('forbidden');
                    }
                }
            }
        }

        renderProgress();
    </script>

    <script name="option">
        document.querySelector('#backToMainPage').onclick = () => {
            window.location.href = '/';
        };

        const progress_2_start = document.querySelector('#progress-2-start');
        const progress_3_start = document.querySelector('#progress-3-start');
        async function start1chat(step) {
            // progress_2_start.disabled = true;
            document.querySelector(`#log${step}`).setAttribute('open', '');
            fetch(`/chatStart`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',  // è¿™ä¸ªæ˜¯å¿…é¡»çš„ï¼Œå¦åˆ™flaskæ— æ³•è§£æ
                },
                body: JSON.stringify({
                    'caseHash': caseHash,
                    'step': step
                }),
            }).then(response => {
                if (response.ok) {
                    return response.json();
                } else {
                    throw new Error(`è¯·æ±‚å¤±è´¥ï¼ŒçŠ¶æ€ç : ${response.status}`);
                }
            }).then(result => {
                console.log(result);
                alert(result['msg']);
                showLogFunctions[step - 1]();
            }).catch(error => {
                alert('è¯·æ±‚å¤±è´¥' + error);
            });
        };

        progress_2_start.onclick = () => { start1chat(2); };
        progress_3_start.onclick = () => { start1chat(3); };

        const optionSelect4 = document.getElementById('optionSelect4');
        const input4 = document.getElementById('input4');
        const button4 = document.getElementById('button4');
        optionSelect4.addEventListener('change', responseSelect4);

        function responseSelect4() {
            const selectedValue = optionSelect4.value;
            if (selectedValue === 'A') {
                input4.innerText = 'ã€æ— éœ€æ›´æ”¹ï¼Œå¯ç›´æ¥æ‰§è¡Œä¸‹ä¸€æ­¥ã€‘';
                input4.classList.remove('inputText');
                button4.classList.remove('forbidden');
                button4.onclick = noNeed4;
            } else if (selectedValue === 'B') {
                input4.innerText = 'åŸæ¡ˆä»¶ä¸­çš„å©šå§»ç™»è®°çŠ¶å†µé”™è¯¯ï¼Œè¯·å°†å©šå§»ç™»è®°æ›´æ”¹æˆç›¸åçš„çŠ¶å†µï¼ˆå³å·²ç™»è®°æ”¹ä¸ºæœªç™»è®°ï¼Œæœªç™»è®°æ”¹ä¸ºå·²ç™»è®°ï¼‰ï¼Œå¹¶æ ¹æ®ä¿®æ”¹åçš„æ¡ˆä»¶æƒ…å†µè¿›è¡Œé‡æ–°åˆ¤å†³';
                input4.classList.add('inputText');
                button4.classList.remove('forbidden');
                button4.onclick = need4;
            } else {
                input4.innerText = 'è¯·åšå‡ºæœ‰æ•ˆé€‰æ‹©ã€‚';
                input4.classList.remove('inputText');
                button4.classList.add('forbidden');
            }
        }

        function noNeed4() {
            fetch(`/chatNoNeed4/${caseHash}`, {
                method: 'POST',
            }).then(response => {
                if (response.ok) {
                    return response.json();
                } else {
                    throw new Error(`ï¼ŒçŠ¶æ€ç : ${response.status}`);
                }
            }).then(result => {
                alert(result['msg']);
                setTimeout(() => {
                    location.reload();  // ç®€å•ç²—æš´
                }, 1500);
            }).catch(error => {
                alert('è¯·æ±‚å¤±è´¥' + error);
            });
            document.querySelector('#log4').setAttribute('open', '');
        }

        function need4() {
            start1chat(4);
        }

        const progress_5_start = document.querySelector('#progress-5-start');
        progress_5_start.onclick = () => { start1chat(5); };
    </script>

    <script name="markdownRender">
        // é…ç½®è§‚å¯Ÿé€‰é¡¹
        const config = {
            childList: true,     // è§‚å¯Ÿå­èŠ‚ç‚¹çš„å˜åŒ–
            subtree: true,       // è§‚å¯Ÿæ‰€æœ‰åä»£èŠ‚ç‚¹
            characterData: true  // è§‚å¯Ÿæ–‡æœ¬å†…å®¹çš„å˜åŒ–
        };

        // markdownæ¸²æŸ“2 - è¿™é‡Œå…ˆå †ç‚¹shiShanä»£ç å¥½äº†
        const output2 = document.getElementById('output2');
        const markdown2 = document.getElementById('markdown2');
        function renderMarkdown2() {
            const inputText = output2.innerHTML;
            const renderedHtml = marked.parse(inputText);
            markdown2.innerHTML = renderedHtml;
        }
        // åˆ›å»ºä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå½“è§‚å¯Ÿåˆ°å˜åŒ–æ—¶æ‰§è¡Œ
        const onOutputModified2 = function (mutationsList, observer) {
            for (let mutation of mutationsList) {
                if (mutation.type === 'childList' || mutation.type === 'characterData') {
                    // è°ƒç”¨ renderMarkdown å‡½æ•°
                    renderMarkdown2();
                }
            }
        };
        // åˆ›å»ºä¸€ä¸ª MutationObserver å®ä¾‹å¹¶ä¼ å…¥å›è°ƒå‡½æ•°
        const observer2 = new MutationObserver(onOutputModified2);
        // å¼€å§‹è§‚å¯Ÿç›®æ ‡èŠ‚ç‚¹
        observer2.observe(output2, config);

        // markdownæ¸²æŸ“3 - å¼€å †
        const output3 = document.getElementById('output3');
        const markdown3 = document.getElementById('markdown3');
        function renderMarkdown3() {
            const inputText = output3.innerHTML;
            const renderedHtml = marked.parse(inputText);
            markdown3.innerHTML = renderedHtml;
        }
        const onOutputModified3 = function (mutationsList, observer) {
            for (let mutation of mutationsList) {
                if (mutation.type === 'childList' || mutation.type === 'characterData') {
                    // è°ƒç”¨ renderMarkdown å‡½æ•°
                    renderMarkdown3();
                }
            }
        };
        const observer3 = new MutationObserver(onOutputModified3);
        observer3.observe(output3, config);

        // markdownæ¸²æŸ“4 - å†å †
        const output4 = document.getElementById('output4');
        const markdown4 = document.getElementById('markdown4');
        function renderMarkdown4() {
            const inputText = output4.innerHTML;
            const renderedHtml = marked.parse(inputText);
            markdown4.innerHTML = renderedHtml;
        }
        const onOutputModified4 = function (mutationsList, observer) {
            for (let mutation of mutationsList) {
                if (mutation.type === 'childList' || mutation.type === 'characterData') {
                    // è°ƒç”¨ renderMarkdown å‡½æ•°
                    renderMarkdown4();
                }
            }
        };
        const observer4 = new MutationObserver(onOutputModified4);
        observer4.observe(output4, config);

        // markdownæ¸²æŸ“5 - æœ€åä¸€å †
        const output5 = document.getElementById('output5');
        const markdown5 = document.getElementById('markdown5');
        function renderMarkdown5() {
            const inputText = output5.innerHTML;
            const renderedHtml = marked.parse(inputText);
            markdown5.innerHTML = renderedHtml;
        }
        const onOutputModified5 = function (mutationsList, observer) {
            for (let mutation of mutationsList) {
                if (mutation.type === 'childList' || mutation.type === 'characterData') {
                    // è°ƒç”¨ renderMarkdown å‡½æ•°
                    renderMarkdown5();
                }
            }
        };
        const observer5 = new MutationObserver(onOutputModified5);
        observer5.observe(output5, config);

    </script>

    <script name="renderMermaid">
        function renderMermaid() {
            // åˆ›å»º script å…ƒç´ 
            const script = document.createElement('script');
            // è®¾ç½®è„šæœ¬çš„ src å±æ€§
            script.src = 'https://letmefly.xyz/Links/mermaid.min.js';
            // ç›‘å¬è„šæœ¬çš„ load äº‹ä»¶
            script.onload = function () {
                // è„šæœ¬åŠ è½½å®Œæˆåï¼Œåˆå§‹åŒ– Mermaid å¹¶æ¸²æŸ“å›¾è¡¨
                mermaid.initialize({ startOnLoad: false });
                mermaid.run({
                    querySelector: '.mermaid'
                });
            };
            // ç›‘å¬è„šæœ¬çš„ error äº‹ä»¶ï¼Œå¤„ç†åŠ è½½å¤±è´¥çš„æƒ…å†µ
            script.onerror = function () {
                console.error('Mermaid è„šæœ¬åŠ è½½å¤±è´¥');
            };
            // å°†è„šæœ¬æ·»åŠ åˆ°æ–‡æ¡£çš„ head ä¸­
            document.head.appendChild(script);
        }

        setTimeout(() => {
            renderMermaid();
        }, 10);
    </script>

    <script>
        // // ä½¿ç”¨EventSourceæ¥æ”¶æµå¼æ•°æ®
        // const eventSource = new EventSource(`/stream/${caseId}`);

        // eventSource.onmessage = (event) => {
        //     const data = JSON.parse(event.data);
        //     if (data.type === 'status_update') {
        //         updateProgress(data);
        //     } else {
        //         appendMessage(data);
        //     }
        // };

        // function appendMessage(data) {
        //     const messageDiv = document.createElement('div');
        //     messageDiv.className = `message ${data.role}-message`;
        //     messageDiv.innerHTML = `
        //         <div class="message-header">${data.sender}</div>
        //         <div class="message-content">${data.content}</div>
        //     `;
        //     chatMessages.appendChild(messageDiv);
        //     chatMessages.scrollTop = chatMessages.scrollHeight;
        // }
    </script>
</body>

</html>